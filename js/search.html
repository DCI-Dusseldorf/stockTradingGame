<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Search Bar</title>
  </head>
  <body>
    <!-- <input id="searchBar" type="texsearcht" placeholder="Search company" /> -->

    <form id="searchForm">
      <input type="text" id="searchField" />
      <button>Search</button>
    </form>

    <div id="results"></div>
  </body>

  <script>
    const searchForm = document.getElementById("searchForm");
    const searchField = document.getElementById("searchField");
    const results = document.getElementById("results");

    searchForm.addEventListener("submit", (e) => {
      e.preventDefault();
      handleSearch();
    });

    async function handleSearch() {
      let query = searchField.value;

      if (query) {
        const search = new Search(query);
        await search.getSearchResults();
        renderSearch(search.found);
      }
    }

    class Search {
      constructor(query) {
        this.query = query;
      }

      async getSearchResults() {
        const res = await fetch(
          //"https://finnhub.io/api/v1/stock/symbol?exchange=US&token=btg6u0748v6r32agatfg"

          `https://www.alphavantage.co/query?function=SYMBOL_SEARCH&keywords=${this.query}&apikey=KS83EIH10ASG1URC`
        );

        const data = await res.json();
        this.results = data;
        this.found = data.bestMatches;

        console.log(data);
      }
    }

    function renderSearch(bestMatches) {
      results.innerHTML = "";
      bestMatches.forEach((stock) => {
        const markup = `<p><b>${stock["1. symbol"]}</b> ${stock["2. name"]}</p>`;
        results.insertAdjacentHTML("beforeend", markup);
      });
    }
  </script>
</html>
